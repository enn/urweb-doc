<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2008 (1.71)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>DML</TITLE>
<META NAME="description" CONTENT="DML">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2008">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="manual.css">

<LINK REL="next" HREF="node40.html">
<LINK REL="previous" HREF="node38.html">
<LINK REL="up" HREF="node36.html">
<LINK REL="next" HREF="node40.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html663"
  HREF="node40.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="icons/next.png"></A> 
<A NAME="tex2html659"
  HREF="node36.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="icons/up.png"></A> 
<A NAME="tex2html653"
  HREF="node38.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="icons/prev.png"></A> 
<A NAME="tex2html661"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html664"
  HREF="node40.html">Sequences</A>
<B> Up:</B> <A NAME="tex2html660"
  HREF="node36.html">SQL</A>
<B> Previous:</B> <A NAME="tex2html654"
  HREF="node38.html">Queries</A>
 &nbsp; <B>  <A NAME="tex2html662"
  HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H3><A NAME="SECTION00094300000000000000">
DML</A>
</H3>

<P>
The Ur/Web library also includes an embedding of a fragment of SQL's DML, the Data Manipulation Language, for modifying database tables.  Any piece of DML may be executed in a transaction.

<P>
<P><!-- MATH
 \begin{displaymath}
\begin{array}{l}
  \mathsf{type} \; \mathsf{dml} \\
  \mathsf{val} \; \mathsf{dml} : \mathsf{dml} \to \mathsf{transaction} \; \mathsf{unit}
\end{array}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="215" HEIGHT="54" BORDER="0"
 SRC="img481.png"
 ALT="\begin{displaymath}\begin{array}{l}
\mathsf{type} \; \mathsf{dml} \\
\mathsf{...
...thsf{dml} \to \mathsf{transaction} \; \mathsf{unit}
\end{array}\end{displaymath}">
</DIV><P>
</P>

<P>
The function <!-- MATH
 $\mathsf{Basis.dml}$
 -->
<IMG
 WIDTH="67" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img482.png"
 ALT="$ \mathsf{Basis.dml}$">
 will trigger a fatal application error if the command fails, for instance, because a data integrity constraint is violated.  An alternate function returns an error message as a string instead.

<P>
<P><!-- MATH
 \begin{displaymath}
\begin{array}{l}
  \mathsf{val} \; \mathsf{tryDml} : \mathsf{dml} \to \mathsf{transaction} \; (\mathsf{option} \; \mathsf{string})
\end{array}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="305" HEIGHT="39" BORDER="0"
 SRC="img483.png"
 ALT="\begin{displaymath}\begin{array}{l}
\mathsf{val} \; \mathsf{tryDml} : \mathsf{d...
...ransaction} \; (\mathsf{option} \; \mathsf{string})
\end{array}\end{displaymath}">
</DIV><P>
</P>

<P>
Properly typed records may be used to form <!-- MATH
 $\mathsf{INSERT}$
 -->
<IMG
 WIDTH="59" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img484.png"
 ALT="$ \mathsf{INSERT}$">
 commands.
<P><!-- MATH
 \begin{displaymath}
\begin{array}{l}
  \mathsf{val} \; \mathsf{insert} : \mathsf{fields} ::: \{\mathsf{Type}\} \to \mathsf{sql\_table} \; \mathsf{fields} \\
  \hspace{.1in} \to \$(\mathsf{map} \; (\mathsf{sql\_exp} \; [] \; [] \; []) \; \mathsf{fields}) \to \mathsf{dml}
\end{array}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="296" HEIGHT="54" BORDER="0"
 SRC="img485.png"
 ALT="\begin{displaymath}\begin{array}{l}
\mathsf{val} \; \mathsf{insert} : \mathsf{f...
...] \; [] \; []) \; \mathsf{fields}) \to \mathsf{dml}
\end{array}\end{displaymath}">
</DIV><P>
</P>

<P>
An <!-- MATH
 $\mathsf{UPDATE}$
 -->
<IMG
 WIDTH="66" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img486.png"
 ALT="$ \mathsf{UPDATE}$">
 command is formed from a choice of which table fields to leave alone and which to change, along with an expression to use to compute the new value of each changed field and a <!-- MATH
 $\mathsf{WHERE}$
 -->
<IMG
 WIDTH="59" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img449.png"
 ALT="$ \mathsf{WHERE}$">
 clause.  Note that, in the table environment applied to expressions, the table being updated is hardcoded at the name <!-- MATH
 $\mathsf{T}$
 -->
<IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img487.png"
 ALT="$ \mathsf{T}$">
.  The parsing extension for <!-- MATH
 $\mathsf{UPDATE}$
 -->
<IMG
 WIDTH="66" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img486.png"
 ALT="$ \mathsf{UPDATE}$">
 will elaborate all table-free field references to use table variable <!-- MATH
 $\mathsf{T}$
 -->
<IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img487.png"
 ALT="$ \mathsf{T}$">
.
<P><!-- MATH
 \begin{displaymath}
\begin{array}{l}
  \mathsf{val} \; \mathsf{update} : \mathsf{unchanged} ::: \{\mathsf{Type}\} \to \mathsf{changed} :: \{\mathsf{Type}\} \to [\mathsf{changed} \sim \mathsf{unchanged}] \\
  \hspace{.1in} \Rightarrow \$(\mathsf{map} \; (\mathsf{sql\_exp} \; [\mathsf{T} = \mathsf{changed} + \hspace{-.075in} + \;\mathsf{unchanged}] \; [] \; []) \; \mathsf{changed}) \\
  \hspace{.1in} \to \mathsf{sql\_table} \; (\mathsf{changed} + \hspace{-.075in} + \;\mathsf{unchanged}) \to \mathsf{sql\_exp} \; [\mathsf{T} = \mathsf{changed} + \hspace{-.075in} + \;\mathsf{unchanged}] \; [] \; [] \; \mathsf{bool} \to \mathsf{dml}
\end{array}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="637" HEIGHT="64" BORDER="0"
 SRC="img488.png"
 ALT="\begin{displaymath}\begin{array}{l}
\mathsf{val} \; \mathsf{update} : \mathsf{u...
...ged}] \; [] \; [] \; \mathsf{bool} \to \mathsf{dml}
\end{array}\end{displaymath}">
</DIV><P>
</P>

<P>
A <!-- MATH
 $\mathsf{DELETE}$
 -->
<IMG
 WIDTH="63" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img489.png"
 ALT="$ \mathsf{DELETE}$">
 command is formed from a table and a <!-- MATH
 $\mathsf{WHERE}$
 -->
<IMG
 WIDTH="59" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img449.png"
 ALT="$ \mathsf{WHERE}$">
 clause.  The above use of <!-- MATH
 $\mathsf{T}$
 -->
<IMG
 WIDTH="15" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img487.png"
 ALT="$ \mathsf{T}$">
 is repeated.
<P><!-- MATH
 \begin{displaymath}
\begin{array}{l}
  \mathsf{val} \; \mathsf{delete} : \mathsf{fields} ::: \{\mathsf{Type}\} \to \mathsf{sql\_table} \; \mathsf{fields} \to \mathsf{sql\_exp} \; [\mathsf{T} = \mathsf{fields}] \; [] \; [] \; \mathsf{bool} \to \mathsf{dml}
\end{array}
\end{displaymath}
 -->
</P>
<DIV ALIGN="CENTER">
<IMG
 WIDTH="559" HEIGHT="30" BORDER="0"
 SRC="img490.png"
 ALT="\begin{displaymath}\begin{array}{l}
\mathsf{val} \; \mathsf{delete} : \mathsf{f...
...lds}] \; [] \; [] \; \mathsf{bool} \to \mathsf{dml}
\end{array}\end{displaymath}">
</DIV><P>
</P>

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html663"
  HREF="node40.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="icons/next.png"></A> 
<A NAME="tex2html659"
  HREF="node36.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="icons/up.png"></A> 
<A NAME="tex2html653"
  HREF="node38.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="icons/prev.png"></A> 
<A NAME="tex2html661"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents"
 SRC="icons/contents.png"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html664"
  HREF="node40.html">Sequences</A>
<B> Up:</B> <A NAME="tex2html660"
  HREF="node36.html">SQL</A>
<B> Previous:</B> <A NAME="tex2html654"
  HREF="node38.html">Queries</A>
 &nbsp; <B>  <A NAME="tex2html662"
  HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>

2014-07-14
</ADDRESS>
</BODY>
</HTML>
